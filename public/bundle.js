var app=function(t){"use strict";function e(t,e){return t[e()%t.length]}function i(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function s(t,e,i=1){return[t[0]+e[0]*i,t[1]+e[1]*i]}function h(t,e){return[e[0]-t[0],e[1]-t[1]]}function a(t,e){return t[0]*e[0]+t[1]*e[1]}function r(t){return[t[1],-t[0]]}function n(t,e){return[t[0]*e,t[1]*e]}function o(t,e,i=1){t[0]+=e[0]*i,t[1]+=e[1]*i}function l(t,e){let s=function(t){let e=i(t)||1;return[t[0]/e,t[1]/e]}(e),o=r(s),l=n(s,a(t,s));return h(n(o,a(t,o)),l)}const d=3;class c{constructor(t,e){this.game=t,this.at=[0,0],this.vel=[0,0],this.dir=[0,0],this.deform=0,this.mass=1,this.speed=1,this.hair="brown",this.skin="#eb9",this.shirt="white",this.pants="blue",this.r=20,this.rotation=0,this.stun=0,Object.assign(this,e),t.bodies.push(this)}get friction(){return this.isPlayer&&0==this.stun?[10,.5]:[.2,1]}get isPlayer(){return this.game.player==this}draw(){let t=n(this.vel,4e-4),e=this.game.ctx;e.save(),e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=1,e.lineWidth=.01,e.translate(...this.at),e.scale(this.r*(1-.5*this.deform),this.r*(1+.5*this.deform)),e.rotate(this.rotation),e.beginPath(),e.fillStyle=this.skin,e.arc(0,0,1,Math.PI,2*Math.PI),e.fill(),e.beginPath(),e.fillStyle=this.shirt,e.arc(0,0,1,0,Math.PI),e.fill(),e.beginPath(),e.fillStyle=this.pants,e.arc(0,0,1,.5,Math.PI-.5),e.fill(),e.beginPath(),e.fillStyle=this.hair,e.arc(0,0,1,Math.PI+.7,-.7),e.fill(),e.lineWidth=.05,e.strokeStyle="white",e.beginPath(),e.moveTo(0,.7),e.lineTo(0,1),e.stroke(),this.stun?(e.fillStyle="white",e.strokeStyle="black",e.beginPath(),e.arc(-.4,-.3,.15,0,2*Math.PI),e.stroke(),e.fill(),e.beginPath(),e.arc(.4,-.3,.25,0,2*Math.PI),e.stroke(),e.fill(),e.fillStyle="black",e.beginPath(),e.arc(.4,-.3,.1,0,2*Math.PI),e.stroke(),e.fill(),e.beginPath(),e.arc(-.4,-.3,.05,0,2*Math.PI),e.stroke(),e.fill()):(e.lineWidth=.1,e.strokeStyle="black",this.isPlayer?(e.beginPath(),e.moveTo(...s(t,[.2,-.3])),e.lineTo(...s(t,[.6,-.3])),e.stroke(),e.beginPath(),e.moveTo(...s(t,[-.2,-.3])),e.lineTo(...s(t,[-.6,-.3])),e.stroke()):(e.beginPath(),e.moveTo(...s(t,[.4,-.25])),e.lineTo(...s(t,[.4,-.5])),e.stroke(),e.beginPath(),e.moveTo(...s(t,[-.4,-.25])),e.lineTo(...s(t,[-.4,-.5])),e.stroke())),e.restore()}think(t){this.isPlayer||(this.stun>=0&&(this.dir=[0,0]),0==this.stun&&(this.dir[1]=.5*Math.sign(this.vel[1]),(Math.random()<t/3||this.at[0]<100||this.at[0]>this.game.width-100)&&(this.dir[0]=(this.at[0]>this.game.width/2?-1:1)*(.5*Math.random()+.5))))}hit(t){let e=(s=this.vel,h=t,i([s[0]-h[0],s[1]-h[1]]));var s,h;this.game.hitSfx(e/500),e>500&&(this.stun=d)}get momentum(){return n(this.vel,this.mass)}collide(t){for(let e of this.game.bodies){if(e==this)continue;let a=h(this.at,e.at),o=r(a),d=i(a);if(this.r+e.r-d>=0){let i=this.mass+e.mass,a=n(s(this.momentum,e.momentum),1/i),r=s(a,l(h(a,this.vel),o)),d=s(a,l(h(a,e.vel),o));this.isPlayer&&e.hit(d),e.isPlayer&&this.hit(r),this.vel=r,e.vel=d,this.at=s(this.at,this.vel,3*t),e.at=s(e.at,e.vel,3*t)}}}update(t){this.think(t),this.stun=Math.max(0,this.stun-t);let e=function(t,e,i=1){return[t[0]*e[0]*i,t[1]*e[1]*i]}(this.dir,[2e3,600],t);return o(this.vel,e),o(this.at,this.vel,t),o(this.vel,[0,1e3],t),this.vel[0]*=1-t*this.friction[0],this.vel[1]*=1-t*this.friction[1],this.deform*=1-3*t,this.at[1]>=this.game.tramH-this.r&&this.at[0]>=30&&this.at[0]<=this.game.width-30&&(this.at[1]=this.game.tramH-this.r,this.vel[1]>0&&(this.vel[1]=-this.vel[1],this.deform=.001*-this.vel[1]),this.game.tramDeform=7),this.at[1]<10&&(this.vel[1]=Math.abs(this.vel[1]),this.deform=.001*this.vel[1]),this.stun?this.rotation+=2*Math.PI/d*t:this.rotation=0,!0}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var f,m=(function(t){function e(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var i=this.b+this.c+this.e;if(i<.18){var s=.18/i;this.b*=s,this.c*=s,this.e*=s}}}var i=new function(){var t,i,s,h,a,r,n,o,l,d,c,f;this._params=new e,this.reset=function(){var t=this._params;h=100/(t.f*t.f+.001),a=100/(t.g*t.g+.001),r=1-t.h*t.h*t.h*.01,n=-t.i*t.i*t.i*1e-6,t.a||(c=.5-t.n/2,f=5e-5*-t.o),o=1+t.l*t.l*(t.l>0?-.9:10),l=0,d=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var e=this._params;return t=e.b*e.b*1e5,i=e.c*e.c*1e5,s=e.e*e.e*1e5+12,3*((t+i+s)/3|0)},this.synthWave=function(e,m){var u=this._params,b=1!=u.s||u.v,v=u.v*u.v*.1,g=1+3e-4*u.w,w=u.s*u.s*u.s*.1,p=1+1e-4*u.t,y=1!=u.s,k=u.x*u.x,M=u.g,P=u.q||u.r,S=u.r*u.r*u.r*.2,x=u.q*u.q*(u.q<0?-1020:1020),T=u.p?32+((1-u.p)*(1-u.p)*2e4|0):0,A=u.d,I=u.j/2,E=u.k*u.k*.01,L=u.a,R=t,K=1/t,W=1/i,C=1/s,D=5/(1+u.u*u.u*20)*(.01+w);D>.8&&(D=.8),D=1-D;for(var q,_,H,V,U,O,j=!1,B=0,F=0,N=0,G=0,X=0,z=0,J=0,Q=0,Y=0,Z=0,$=new Array(1024),tt=new Array(32),et=$.length;et--;)$[et]=0;for(et=tt.length;et--;)tt[et]=2*Math.random()-1;for(et=0;et<m;et++){if(j)return et;if(T&&++Y>=T&&(Y=0,this.reset()),d&&++l>=d&&(d=0,h*=o),(h*=r+=n)>a&&(h=a,M>0&&(j=!0)),_=h,I>0&&(Z+=E,_*=1+Math.sin(Z)*I),(_|=0)<8&&(_=8),L||((c+=f)<0?c=0:c>.5&&(c=.5)),++F>R)switch(F=0,++B){case 1:R=i;break;case 2:R=s}switch(B){case 0:N=F*K;break;case 1:N=1+2*(1-F*W)*A;break;case 2:N=1-F*C;break;case 3:N=0,j=!0}P&&((H=0|(x+=S))<0?H=-H:H>1023&&(H=1023)),b&&g&&((v*=g)<1e-5?v=1e-5:v>.1&&(v=.1)),O=0;for(var it=8;it--;){if(++J>=_&&(J%=_,3==L))for(var st=tt.length;st--;)tt[st]=2*Math.random()-1;switch(L){case 0:U=J/_<c?.5:-.5;break;case 1:U=1-J/_*2;break;case 2:U=.225*(((U=1.27323954*(V=6.28318531*((V=J/_)>.5?V-1:V))+.405284735*V*V*(V<0?1:-1))<0?-1:1)*U*U-U)+U;break;case 3:U=tt[Math.abs(32*J/_|0)]}b&&(q=z,(w*=p)<0?w=0:w>.1&&(w=.1),y?(X+=(U-z)*w,X*=D):(z=U,X=0),G+=(z+=X)-q,U=G*=1-v),P&&($[Q%1024]=U,U+=$[(Q-H+1024)%1024],Q++),O+=U}O*=.125*N*k,e[et]=O>=1?32767:O<=-1?-32768:32767*O|0}return m}},s=function(t){i._params.setSettings(t);var e=i.totalReset(),s=new Uint8Array(4*((e+1)/2|0)+44),h=2*i.synthWave(new Uint16Array(s.buffer,44),e),a=new Uint32Array(s.buffer,0,44);a[0]=1179011410,a[1]=h+36,a[2]=1163280727,a[3]=544501094,a[4]=16,a[5]=65537,a[6]=44100,a[7]=88200,a[8]=1048578,a[9]=1635017060,a[10]=h,h+=44;for(var r=0,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="data:audio/wav;base64,";r<h;r+=3){var l=s[r]<<16|s[r+1]<<8|s[r+2];o+=n[l>>18]+n[l>>12&63]+n[l>>6&63]+n[63&l]}return o};t.exports=s}(f={exports:{}},f.exports),f.exports);let u=["black","black","brown","brown","yellow","purple"],b=["#eb9","#eb9","brown"],v=["black","blue","brown","brown","gray","darkgreen"];function g(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}let w,p=[[0,-1],[-1,0],[0,1],[1,0]];class y{constructor(t){this.canvas=t,this.bodies=[],this.time=0,this.tramVel=0,this.tramMass=10,this.ctx=t.getContext("2d"),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,this.canvas.height=this.height,this.canvas.width=this.width,this.tramDeform=0,this.tramCenter=this.height-10,this.player=new c(this,{r:20,mass:1,at:[200,300],hair:"black",shirt:"red",pants:"black"});for(let t=0;t<2;t++)this.spawnKid()}spawnKid(){let t=Math.random()<.5?-1:1;new c(this,{dir:[-t,0],speed:.5*Math.random()+.5,at:[-1==t?-30:this.width+30,400+g()%200],hair:e(u,g),pants:e(v,g),skin:e(b,g)})}update(t,e){this.lastLoopTimeStamp||(this.lastLoopTimeStamp=t-.001);let i=Math.min(.02,(t-this.lastLoopTimeStamp)/1e3);this.lastLoopTimeStamp=t,this.time+=i,(Math.random()<.05*i*(1+this.time/20)||this.bodies.length<2)&&this.spawnKid();let h=e.reduce((t,e,i)=>e?s(t,p[i%4]):t,[0,0]);this.player.dir=h,this.tramDeform+=this.tramVel*i,this.tramVel=this.tramVel*(1-Math.abs(this.tramVel)*i*.3)-this.tramDeform*i*100;for(let t of this.bodies)t.update(i);for(let t of this.bodies)t.collide(i);this.bodies=this.bodies.filter(t=>t.at[1]<=this.height+20),this.draw()}get tramH(){return this.tramCenter+this.tramDeform}draw(){let t=this.ctx;t.clearRect(0,0,this.width,this.height);for(let t of this.bodies)t.draw();t.save(),t.strokeStyle="black",t.lineWidth=2,t.fillRect(50,this.tramH,this.width-100,30),t.restore()}sfx(t){try{var e=m(t),i=new Audio;i.src=e,i.play()}catch(t){console.error(t)}}sfxRnd(t,e=.01){let i=t.slice();i[23]*=.2*Math.random()+.8,i[5]*=Math.random()+.5,this.sfx(i)}hitSfx(t=1){this.sfxRnd([3,,.0366,,.2694,.4668,,-.6978,,,,,,,,,,,1,,,,,.5*t])}}let k,M=[...new Array(8)].map(t=>!1),P=["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowDown","ArrowRight"],S=!1;function x(t){(k=t)||w.getContext("2d").clearRect(0,0,1200,1200)}return window.onload=function(){w=document.getElementById("main"),x(new y(w)),w.addEventListener("mouseleave",t=>{}),w.addEventListener("mouseenter",t=>{}),document.addEventListener("keyup",t=>{let e=P.indexOf(t.code);e>=0&&(M[e]=!1)}),document.addEventListener("keydown",t=>{let e=P.indexOf(t.code);e>=0&&(M[e]=!0),"Escape"==t.code&&x(new y(w)),"KeyP"==t.code&&(S=!S)}),function t(e){requestAnimationFrame(i=>{e(i),t(e)})}(t=>{k&&!S&&k.update(t,M)}),x(k)},t.mouseAt=void 0,t}({});
