var app=function(t){"use strict";function e(t,e){return t[e()%t.length]}function i(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function s(t,e,i=1){return[t[0]+e[0]*i,t[1]+e[1]*i]}function a(t,e){return[e[0]-t[0],e[1]-t[1]]}function r(t,e){return t[0]*e[0]+t[1]*e[1]}function h(t){return[t[1],-t[0]]}function n(t,e){return[t[0]*e,t[1]*e]}function l(t,e,i=1){t[0]+=e[0]*i,t[1]+=e[1]*i}function o(t,e){let s=function(t){let e=i(t)||1;return[t[0]/e,t[1]/e]}(e),l=h(s),o=n(s,r(t,s));return a(n(l,r(t,l)),o)}class c{constructor(t){this.game=t}update(t){return!1}draw(){}}class d extends c{constructor(t,e,i){super(t.game),this.kid=t,this.type=e,this.color=i,this.time=0,this.mounted=!0}update(t){return this.time+=t,this.at=s(this.at,this.vel,t),this.vel=s(this.vel,[0,400],t),this.at[1]<this.game.height+40}launch(){this.game.fx.push(this),this.mounted=!1,this.vel=[0,-100],this.at=s(this.kid.at,this.shift)}get shift(){return[[0,0],[0,-1],[0,-1],[0,0],[0,-.4],[0,-.5],[0,1.1]][this.type]}draw(){let t=this.game.ctx;switch(t.save(),this.mounted||(t.translate(...this.at),t.scale(20,20),t.rotate(10*-this.time)),t.fillStyle=this.color,t.strokeStyle=this.color,t.lineWidth=.05,[4,5].includes(this.type)&&this.mounted&&t.translate(...this.kid.eyeShift),this.mounted&&t.translate(...this.shift),this.type){case 1:t.beginPath(),t.moveTo(-.9,.4),t.quadraticCurveTo(-.9,-.2,0,-.2),t.quadraticCurveTo(.9,-.2,.9,.4),t.lineTo(-1.2,.4),t.lineTo(-1.2,.3),t.lineTo(-.7,.3),t.fill();break;case 2:t.beginPath(),t.moveTo(-.9,.3),t.lineTo(-.9,-.2),t.lineTo(.9,-.2),t.lineTo(.9,.3),t.lineTo(1.3,.3),t.lineTo(1.3,.4),t.lineTo(-1.3,.4),t.lineTo(-1.3,.3),t.fill();break;case 3:t.beginPath(),t.lineTo(-.5,-.2),t.lineTo(.5,.2),t.lineTo(.5,-.2),t.lineTo(-.5,.2),t.lineTo(-.5,-.2),t.fill();break;case 4:t.fillStyle="rgba(200,200,200,0.5)",t.beginPath(),t.arc(-.4,0,.4,0,2*Math.PI),t.fill(),t.stroke(),t.beginPath(),t.arc(.4,0,.4,0,2*Math.PI),t.stroke(),t.fill();break;case 5:t.fillStyle="black",t.beginPath(),t.arc(-.4,0,.4,0,Math.PI),t.fill(),t.stroke(),t.beginPath(),t.arc(.4,0,.4,0,Math.PI),t.stroke(),t.fill();break;case 6:t.beginPath(),t.arc(-.5,0,.35,Math.PI,2*Math.PI),t.fill(),t.beginPath(),t.arc(.5,0,.35,Math.PI,2*Math.PI),t.fill()}t.restore()}}let f=["black","black","brown","brown","yellow","purple"],u=["#8d5524","#c68642","#e0ac69","#f1c27d","#ffdbac","#ffdbac","#ffdbac"],m=["black","white","white","white","gray","pink","yellow","orange"],y=["black","blue","brown","brown","gray","darkgreen"],g=["black","blue","black","brown","gray","darkgreen","darkRed","white"];const b=3;class v{constructor(t,e){this.game=t,this.at=[0,0],this.vel=[0,0],this.dir=[0,0],this.deform=0,this.mass=1,this.speed=1,this.lastHitBy=0,this.lastHitTime=0,this.hair="brown",this.skin="#eb9",this.shirt="white",this.pants="blue",this.r=20,this.rotation=0,this.stun=0,Object.assign(this,e),t.kids.push(this)}get friction(){return this.isPlayer&&0==this.stun?[10,.5]:[.2,1]}get isPlayer(){return this.player>0}get eyeShift(){return n(this.vel,4e-4)}draw(){let t=this.game.ctx;t.save(),t.shadowColor="rgba(0,0,0,0.5)",t.shadowBlur=1,t.shadowOffsetX=1,t.shadowOffsetY=1,t.lineWidth=.01,t.translate(...this.at),this.isPlayer&&(t.textAlign="center",t.font="12pt Verdana",t.fillStyle="black",t.fillText("P"+this.player,0,-40)),t.scale(this.r*(1-.5*this.deform),this.r*(1+.5*this.deform)),t.rotate(this.rotation),t.beginPath(),t.fillStyle=this.skin,t.arc(0,0,1,Math.PI,2*Math.PI),t.fill(),t.beginPath(),t.fillStyle=this.shirt,t.arc(0,0,1,0,Math.PI),t.fill(),t.beginPath(),t.fillStyle=this.pants,t.arc(0,0,1,.5,Math.PI-.5),t.fill(),t.beginPath(),t.fillStyle=this.hair,t.arc(0,0,1,Math.PI+.7,-.7),t.fill(),this.stun?(t.fillStyle="white",t.strokeStyle="black",t.beginPath(),t.arc(-.4,-.3,.15,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.arc(.4,-.3,.25,0,2*Math.PI),t.stroke(),t.fill(),t.fillStyle="black",t.beginPath(),t.arc(.4,-.3,.1,0,2*Math.PI),t.stroke(),t.fill(),t.beginPath(),t.arc(-.4,-.3,.05,0,2*Math.PI),t.stroke(),t.fill()):(t.lineWidth=.1,t.strokeStyle="black",t.save(),t.translate(...this.eyeShift),this.isPlayer?(t.beginPath(),t.moveTo(.2,-.3),t.lineTo(.6,-.3),t.stroke(),t.beginPath(),t.moveTo(-.2,-.3),t.lineTo(-.6,-.3),t.stroke()):(t.beginPath(),t.moveTo(.4,-.25),t.lineTo(.4,-.5),t.stroke(),t.beginPath(),t.moveTo(-.4,-.25),t.lineTo(-.4,-.5),t.stroke()),t.restore()),t.save(),t.lineWidth=.05,t.strokeStyle="rgba(255,255,255,0.8)",t.shadowOffsetX=-1,t.shadowOffsetY=-1,t.beginPath(),t.moveTo(0,.7),t.lineTo(0,1),t.stroke(),t.restore(),this.accessory&&this.accessory.draw(),t.restore()}think(t){this.isPlayer||(this.stun>=0&&(this.dir=[0,0]),0==this.stun&&(this.dir[1]=.5*Math.sign(this.vel[1]),(Math.random()<t/3||this.at[0]<100||this.at[0]>this.game.width-100)&&(this.dir[0]=(this.at[0]>this.game.width/2?-1:1)*(.5*Math.random()+.5))))}hit(t,e){let s=(a=this.vel,r=t,i([a[0]-r[0],a[1]-r[1]]));var a,r;e.isPlayer&&(this.game.hitSfx(s/500),this.lastHitBy=e.player,this.lastHitTime=0,s>500&&(e.isPlayer&&this.accessory&&(this.accessory.launch(),delete this.accessory),this.stun=b))}get momentum(){return n(this.vel,this.mass)}collide(t){for(let e of this.game.kids){if(e==this)continue;let r=a(this.at,e.at),l=h(r),c=i(r);if(this.r+e.r-c>=0){let i=this.mass+e.mass,r=n(s(this.momentum,e.momentum),1/i),h=s(r,o(a(r,this.vel),l)),c=s(r,o(a(r,e.vel),l));e.hit(c,this),this.hit(h,e),this.vel=h,e.vel=c,this.at=s(this.at,this.vel,3*t),e.at=s(e.at,e.vel,3*t)}}}update(t){if(this.think(t),this.stun=Math.max(0,this.stun-t),!this.stun){let e=function(t,e,i=1){return[t[0]*e[0]*i,t[1]*e[1]*i]}(this.dir,[2e3,600],t);l(this.vel,e)}return l(this.at,this.vel,t),l(this.vel,[0,1e3],t),this.vel[0]*=1-t*this.friction[0],this.vel[1]*=1-t*this.friction[1],this.deform*=1-3*t,this.at[1]>=this.game.tramH-this.r&&this.at[0]>=30&&this.at[0]<=this.game.width-30&&(this.at[1]=this.game.tramH-this.r,this.vel[1]>0&&(this.vel[1]=-this.vel[1],this.deform=.001*-this.vel[1]),this.game.tramDeform=7),this.at[1]<10&&(this.vel[1]=Math.abs(this.vel[1]),this.deform=.001*this.vel[1]),this.stun?this.rotation+=2*Math.PI/b*t:this.rotation=0,this.lastHitBy&&(this.lastHitTime+=t,this.lastHitTime>=10&&(this.lastHitBy=0)),!0}static newKid(t){let i=Math.random()<.5?-1:1,s=t.rni,a=.8+.4*Math.random(),r=new v(t,{dir:[-i,0],speed:.5*Math.random()+.5,at:[-1==i?-30:t.width+30,s()%600],hair:e(f,s),pants:e(y,s),skin:e(u,s),shirt:e(m,s),r:20*a,mass:1*Math.pow(a,2)});return r.accessory=new d(r,1+s()%6,e(g,s)),r}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var p,k=(function(t){function e(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var i=this.b+this.c+this.e;if(i<.18){var s=.18/i;this.b*=s,this.c*=s,this.e*=s}}}var i=new function(){var t,i,s,a,r,h,n,l,o,c,d,f;this._params=new e,this.reset=function(){var t=this._params;a=100/(t.f*t.f+.001),r=100/(t.g*t.g+.001),h=1-t.h*t.h*t.h*.01,n=-t.i*t.i*t.i*1e-6,t.a||(d=.5-t.n/2,f=5e-5*-t.o),l=1+t.l*t.l*(t.l>0?-.9:10),o=0,c=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var e=this._params;return t=e.b*e.b*1e5,i=e.c*e.c*1e5,s=e.e*e.e*1e5+12,3*((t+i+s)/3|0)},this.synthWave=function(e,u){var m=this._params,y=1!=m.s||m.v,g=m.v*m.v*.1,b=1+3e-4*m.w,v=m.s*m.s*m.s*.1,p=1+1e-4*m.t,k=1!=m.s,w=m.x*m.x,P=m.g,T=m.q||m.r,M=m.r*m.r*m.r*.2,S=m.q*m.q*(m.q<0?-1020:1020),x=m.p?32+((1-m.p)*(1-m.p)*2e4|0):0,I=m.d,A=m.j/2,E=m.k*m.k*.01,H=m.a,C=t,L=1/t,R=1/i,W=1/s,B=5/(1+m.u*m.u*20)*(.01+v);B>.8&&(B=.8),B=1-B;for(var K,q,D,O,U,V,_=!1,Y=0,j=0,G=0,N=0,X=0,$=0,F=0,z=0,J=0,Q=0,Z=new Array(1024),tt=new Array(32),et=Z.length;et--;)Z[et]=0;for(et=tt.length;et--;)tt[et]=2*Math.random()-1;for(et=0;et<u;et++){if(_)return et;if(x&&++J>=x&&(J=0,this.reset()),c&&++o>=c&&(c=0,a*=l),(a*=h+=n)>r&&(a=r,P>0&&(_=!0)),q=a,A>0&&(Q+=E,q*=1+Math.sin(Q)*A),(q|=0)<8&&(q=8),H||((d+=f)<0?d=0:d>.5&&(d=.5)),++j>C)switch(j=0,++Y){case 1:C=i;break;case 2:C=s}switch(Y){case 0:G=j*L;break;case 1:G=1+2*(1-j*R)*I;break;case 2:G=1-j*W;break;case 3:G=0,_=!0}T&&((D=0|(S+=M))<0?D=-D:D>1023&&(D=1023)),y&&b&&((g*=b)<1e-5?g=1e-5:g>.1&&(g=.1)),V=0;for(var it=8;it--;){if(++F>=q&&(F%=q,3==H))for(var st=tt.length;st--;)tt[st]=2*Math.random()-1;switch(H){case 0:U=F/q<d?.5:-.5;break;case 1:U=1-F/q*2;break;case 2:U=.225*(((U=1.27323954*(O=6.28318531*((O=F/q)>.5?O-1:O))+.405284735*O*O*(O<0?1:-1))<0?-1:1)*U*U-U)+U;break;case 3:U=tt[Math.abs(32*F/q|0)]}y&&(K=$,(v*=p)<0?v=0:v>.1&&(v=.1),k?(X+=(U-$)*v,X*=B):($=U,X=0),N+=($+=X)-K,U=N*=1-g),T&&(Z[z%1024]=U,U+=Z[(z-D+1024)%1024],z++),V+=U}V*=.125*G*w,e[et]=V>=1?32767:V<=-1?-32768:32767*V|0}return u}},s=function(t){i._params.setSettings(t);var e=i.totalReset(),s=new Uint8Array(4*((e+1)/2|0)+44),a=2*i.synthWave(new Uint16Array(s.buffer,44),e),r=new Uint32Array(s.buffer,0,44);r[0]=1179011410,r[1]=a+36,r[2]=1163280727,r[3]=544501094,r[4]=16,r[5]=65537,r[6]=44100,r[7]=88200,r[8]=1048578,r[9]=1635017060,r[10]=a,a+=44;for(var h=0,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l="data:audio/wav;base64,";h<a;h+=3){var o=s[h]<<16|s[h+1]<<8|s[h+2];l+=n[o>>18]+n[o>>12&63]+n[o>>6&63]+n[63&o]}return l};t.exports=s}(p={exports:{}},p.exports),p.exports);let w,P,T,M=[[0,-1],[-1,0],[0,1],[1,0]];class S{constructor(t,e){this.canvas=t,this.updateUI=e,this.players=[],this.kids=[],this.fx=[],this.time=0,this.kidEta=0,this.score=[0,0,0],this.tramVel=0,this.tramMass=10,this.ctx=t.getContext("2d"),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,this.canvas.height=this.height,this.canvas.width=this.width,this.tramDeform=0,this.tramCenter=this.height-10}rni(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}spawnPlayer(t){if(this.players[t])return;let e=v.newKid(this);this.players[t]=e,e.at=[1==t?200:this.width-200,300],e.r=20,e.mass=1,e.player=t,this.updateUI()}over(){return this.kids.length>=15}update(t,e){this.lastLoopTimeStamp||(this.lastLoopTimeStamp=t-.001);let i=Math.min(.02,(t-this.lastLoopTimeStamp)/1e3);this.lastLoopTimeStamp=t,this.time+=i,this.kidEta-=i,this.playersAlive()&&(this.kidEta<=0||this.kids.length<3)&&(v.newKid(this),this.kidEta=400/(30+this.time));let s=[,[0,0],[0,0]];for(let t=0;t<8;t++)if(e[t]){let e=Math.floor(t/4)+1;l(s[e],M[t%4]),this.players[e]||this.spawnPlayer(e)}for(let t=1;t<=2;t++)this.players[t]&&(this.players[t].dir=s[t]);this.tramDeform+=this.tramVel*i,this.tramVel=this.tramVel*(1-Math.abs(this.tramVel)*i*.3)-this.tramDeform*i*100;for(let t of this.kids)t.update(i);for(let t of this.kids)t.collide(i);this.fx=this.fx.filter(t=>t.update(i)),this.kids=this.kids.filter(t=>!(t.at[1]>this.height+20)||(t.isPlayer&&(delete this.players[t.player],this.score[t.player]-=5),t.lastHitBy&&this.score[t.lastHitBy]++,!1)),this.draw(),this.over()&&this.updateUI()}get tramH(){return this.tramCenter+this.tramDeform}playersAlive(){return this.players.some(t=>t)}draw(){let t=this.ctx;t.fillStyle="black",t.clearRect(0,0,this.width,this.height),t.save(),t.strokeStyle="black",t.lineWidth=2,t.fillRect(50,this.tramH,this.width-100,30),t.restore();for(let t of this.kids)t.draw();for(let t of this.fx)t.draw();t.save(),t.font="24pt Verdana",t.textAlign="center",t.fillStyle="white",this.kids.length>0&&t.fillText(`Kids: ${this.kids.length}/15`,this.width/2,30);for(let e=1;e<=2;e++)this.score[e]&&t.fillText(`P${e} ${this.score[e]} pts`,1==e?200:this.width-200,30);t.restore()}sfx(t){try{var e=k(t),i=new Audio;i.src=e,i.play()}catch(t){console.error(t)}}sfxRnd(t,e=.01){let i=t.slice();i[23]*=.2*Math.random()+.8,i[5]*=Math.random()+.5,this.sfx(i)}hitSfx(t=1){this.sfxRnd([3,,.0366,,.2694,.4668,,-.6978,,,,,,,,,,,1,,,,,.5*t])}}let x,I=[...new Array(8)].map(t=>!1),A=["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowDown","ArrowRight"],E=!1;function H(t){if((x=t)||w.getContext("2d").clearRect(0,0,1200,1200),x){let t="Neighborhood kids caught a wind of you getting a giant trampoline and want to play.<br/>\nThough, they have no safety training, so you have no choice but politely ask them to leave.<br/>\nThey may object, but a strong enough kick makes them lose control temporarily, letting you usher them out.<br/>\nYou get a point for each de-trampolined kid.<br/>\nIf you fall off, you lose 5 points.<br/>\nGame ends when there are 15 kids present (including you).<br/>\n<br/>\n<b>Move with WASD (for player 1) or arrow keys (for player 2). P to pause. ESC to reset.</b><br/>\n<br/>\nHave fun, and don't act recklessly or agressively on trampoline in real life!<br/>\n",e=x.over()?"<h3>Game over</h3>You are overrun.<br/><br/>Press ESC to restart":E?`<h3>Paused</h3></br>${t}`:x.playersAlive()?"":t;P.innerHTML=e}}function C(){H(x)}return window.onload=function(){w=document.getElementById("main"),P=document.getElementById("ui"),T=w.getContext("2d"),H(new S(w,C)),w.addEventListener("mousedown",t=>{console.log(x)}),w.addEventListener("mouseleave",t=>{}),w.addEventListener("mouseenter",t=>{}),document.addEventListener("keyup",t=>{let e=A.indexOf(t.code);e>=0&&(I[e]=!1)}),document.addEventListener("keydown",t=>{let e=A.indexOf(t.code);e>=0&&(I[e]=!0,E&&(E=!1,C())),"Escape"==t.code&&H(new S(w,C)),"KeyP"==t.code&&(E=!E,C())}),function t(e){requestAnimationFrame(i=>{e(i),t(e)})}(t=>{!x||E||x.over()||x.update(t,I)}),H(x)},t.mouseAt=void 0,t}({});
